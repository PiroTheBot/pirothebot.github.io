<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repository Pattern ‚Äî Learning Corner</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Progress indicator -->
    <div class="progress-bar">
        <div class="progress-fill"></div>
    </div>

    <!-- Navigation -->
    <nav class="top-nav">
        <a href="../../" class="back-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
            </svg>
            Learning Corner
        </a>
        <span class="breadcrumb">Design Patterns / Repository Pattern</span>
    </nav>

    <main>
        <!-- Hero Section -->
        <section class="hero">
            <div class="icon-container">
                <svg class="icon-large" viewBox="0 0 100 100">
                    <!-- Database icon -->
                    <circle cx="50" cy="20" r="15" fill="none" stroke="currentColor" stroke-width="3"/>
                    <ellipse cx="50" cy="35" rx="30" ry="10" fill="none" stroke="currentColor" stroke-width="3"/>
                    <path d="M20 35 Q20 60, 50 60 Q80 60, 80 35" fill="none" stroke="currentColor" stroke-width="3"/>
                    <ellipse cx="50" cy="35" rx="30" ry="10" fill="var(--accent-dim)" fill-opacity="0.1"/>
                    <!-- Connection lines -->
                    <circle cx="20" cy="35" r="4" fill="var(--accent)"/>
                    <circle cx="80" cy="35" r="4" fill="var(--accent)"/>
                    <line x1="24" y1="35" x2="40" y2="25" stroke="var(--accent)" stroke-width="2" class="connector"/>
                    <line x1="76" y1="35" x2="60" y2="25" stroke="var(--accent)" stroke-width="2" class="connector"/>
                </svg>
            </div>
            <h1>The Repository Pattern</h1>
            <p class="tagline">Understanding how to talk to databases the clean way</p>
        </section>

        <!-- Quick Summary -->
        <section class="card summary">
            <h2>
                <span class="icon">üìã</span>
                Quick Summary
            </h2>
            <p>The Repository Pattern is like having a <strong>librarian</strong> between you and the library's books. Instead of running around the stacks yourself, you tell the librarian what you want, and they find it for you. This keeps your code organized and easy to change.</p>
        </section>

        <!-- WHAT Section -->
        <section class="card" id="what">
            <h2>
                <span class="icon">‚ùì</span>
                What is it?
            </h2>
            
            <!-- Visual Analogy -->
            <div class="analogy-box">
                <h3>The Library Analogy</h3>
                <div class="analogy-visual">
                    <div class="analogy-item">
                        <div class="analogy-icon">
                            <svg viewBox="0 0 60 60">
                                <rect x="10" y="10" width="40" height="45" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
                                <line x1="18" y1="20" x2="42" y2="20" stroke="currentColor" stroke-width="2"/>
                                <line x1="18" y1="28" x2="42" y2="28" stroke="currentColor" stroke-width="2"/>
                                <line x1="18" y1="36" x2="35" y2="36" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <span>Database</span>
                        <small>The Library</small>
                    </div>
                    <div class="analogy-arrow">
                        <svg viewBox="0 0 60 20">
                            <path d="M0 10 L45 10 M40 5 L50 10 L40 15" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="analogy-item">
                        <div class="analogy-icon highlight">
                            <svg viewBox="0 0 60 60">
                                <circle cx="30" cy="25" r="12" fill="none" stroke="currentColor" stroke-width="2"/>
                                <circle cx="30" cy="50" r="15" fill="none" stroke="currentColor" stroke-width="2"/>
                                <circle cx="30" cy="25" r="8" fill="var(--accent)" fill-opacity="0.2"/>
                            </svg>
                        </div>
                        <span>Repository</span>
                        <small>The Librarian</small>
                    </div>
                    <div class="analogy-arrow">
                        <svg viewBox="0 0 60 20">
                            <path d="M0 10 L45 10 M40 5 L50 10 L40 15" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <div class="analogy-item">
                        <div class="analogy-icon">
                            <svg viewBox="0 0 60 60">
                                <rect x="15" y="10" width="30" height="40" rx="3" fill="none" stroke="currentColor" stroke-width="2"/>
                                <circle cx="30" cy="30" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <span>Your Code</span>
                        <small>You</small>
                    </div>
                </div>
                <p class="analogy-text">
                    The <strong>librarian (Repository)</strong> knows exactly where every book is. You just say "I want all books by this author" and they bring them to you. You never touch the library's organization system directly.
                </p>
            </div>

            <!-- Technical Definition -->
            <div class="definition">
                <h3>Technical Definition</h3>
                <p>A <strong>Repository</strong> is a layer that mediates between your domain logic and the data access layer. It abstracts the database operations behind a collection-like interface, making your code independent of specific database technologies.</p>
            </div>
        </section>

        <!-- WHY Section -->
        <section class="card" id="why">
            <h2>
                <span class="icon">üí°</span>
                Why use it?
            </h2>
            
            <div class="benefits-grid">
                <div class="benefit">
                    <div class="benefit-icon">
                        <svg viewBox="0 0 40 40">
                            <rect x="5" y="10" width="30" height="20" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
                            <circle cx="20" cy="20" r="5" fill="var(--accent)"/>
                        </svg>
                    </div>
                    <h4>Single Source of Truth</h4>
                    <p>All data access logic lives in one place. Change how you query data? Update one file, not fifty.</p>
                </div>
                <div class="benefit">
                    <div class="benefit-icon">
                        <svg viewBox="0 0 40 40">
                            <path d="M10 30 L20 10 L30 30" fill="none" stroke="currentColor" stroke-width="2"/>
                            <circle cx="20" cy="20" r="3" fill="var(--accent)"/>
                        </svg>
                    </div>
                    <h4>Easier Testing</h4>
                    <p>Swap the real database for fake data in tests. Your tests run fast and don't break when the database is down.</p>
                </div>
                <div class="benefit">
                    <div class="benefit-icon">
                        <svg viewBox="0 0 40 40">
                            <rect x="8" y="8" width="24" height="24" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
                            <rect x="14" y="14" width="12" height="12" fill="var(--accent)" fill-opacity="0.2"/>
                        </svg>
                    </div>
                    <h4>Database Independence</h4>
                    <p>Switch from PostgreSQL to MongoDB without rewriting your business logic. Just change the repository implementation.</p>
                </div>
                <div class="benefit">
                    <div class="benefit-icon">
                        <svg viewBox="0 0 40 40">
                            <circle cx="20" cy="15" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            <path d="M10 32 Q20 22, 30 32" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <h4>Cleaner Code</h4>
                    <p>Your business logic stays focused on business. No SQL queries mixed with your actual application code.</p>
                </div>
            </div>
        </section>

        <!-- WHEN Section -->
        <section class="card" id="when">
            <h2>
                <span class="icon">‚è∞</span>
                When should you use it?
            </h2>
            
            <div class="timeline">
                <div class="timeline-item yes">
                    <div class="timeline-marker">‚úÖ</div>
                    <div class="timeline-content">
                        <h4>Use Repository Pattern when:</h4>
                        <ul>
                            <li>Your application has multiple data sources (database, API, cache)</li>
                            <li>You need to unit test business logic without touching a database</li>
                            <li>Your data access logic is getting complex and repetitive</li>
                            <li>You want to keep your code framework-agnostic</li>
                            <li>Team members need to work on data access and business logic separately</li>
                        </ul>
                    </div>
                </div>
                <div class="timeline-item no">
                    <div class="timeline-marker">‚è≥</div>
                    <div class="timeline-content">
                        <h4>Consider skipping if:</h4>
                        <ul>
                            <li>Your app is very simple (CRUD on a single table)</li>
                            <li>You're using an ORM that already provides good abstraction (like Prisma, Hibernate)</li>
                            <li>Rapid prototyping where abstraction adds overhead</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- HOW Section -->
        <section class="card" id="how">
            <h2>
                <span class="icon">üîß</span>
                How does it work?
            </h2>

            <!-- Step by step visualization -->
            <div class="steps-visual">
                <div class="step" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Define the Interface</h4>
                        <p>Tell the world what operations you support</p>
                        <div class="code-block">
                            <code>
<span class="keyword">interface</span> <span class="type">UserRepository</span> {
    <span class="function">findById</span>(id: <span class="type">string</span>): <span class="type">Promise</span>&lt;<span class="type">User</span>&gt;;
    <span class="function">findByEmail</span>(email: <span class="type">string</span>): <span class="type">Promise</span>&lt;<span class="type">User</span> | <span class="keyword">null</span>&gt;;
    <span class="function">save</span>(user: <span class="type">User</span>): <span class="type">Promise</span>&lt;<span class="type">void</span>&gt;;
    <span class="function">delete</span>(id: <span class="type">string</span>): <span class="type">Promise</span>&lt;<span class="type">void</span>&gt;;
}
                            </code>
                        </div>
                    </div>
                </div>

                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Implement the Interface</h4>
                        <p>Actually talk to the database</p>
                        <div class="code-block">
                            <code>
<span class="keyword">class</span> <span class="type">PostgresUserRepository</span> <span class="keyword">implements</span> <span class="type">UserRepository</span> {
    <span class="keyword">constructor</span>(<span class="variable">private</span> db: <span class="type">Database</span>) {}
    
    <span class="async">async</span> <span class="function">findById</span>(id: <span class="type">string</span>) {
        <span class="keyword">const</span> row = <span class="keyword">await</span> <span class="variable">this</span>.db.query(
            <span class="string">'SELECT * FROM users WHERE id = $1'</span>, [id]
        );
        <span class="keyword">return</span> row ? <span class="function">mapToUser</span>(row) : <span class="keyword">null</span>;
    }
}
                            </code>
                        </div>
                    </div>
                </div>

                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Use in Your Code</h4>
                        <p>Clean, testable business logic</p>
                        <div class="code-block">
                            <code>
<span class="keyword">class</span> <span class="type">UserService</span> {
    <span class="keyword">constructor</span>(<span class="variable">private</span> userRepo: <span class="type">UserRepository</span>) {}
    
    <span class="async">async</span> <span class="function">registerUser</span>(email: <span class="type">string</span>) {
        <span class="comment">// No SQL here! Just business logic</span>
        <span class="keyword">const</span> exists = <span class="keyword">await</span> <span class="variable">this</span>.userRepo.<span class="function">findByEmail</span>(email);
        <span class="keyword">if</span> (exists) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">Error</span>(<span class="string">'Already exists'</span>);
        
        <span class="comment">// ... create user ...</span>
    }
}
                            </code>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Before/After Comparison -->
        <section class="card comparison">
            <h2>
                <span class="icon">üîÑ</span>
                Before vs After
            </h2>
            
            <div class="comparison-grid">
                <div class="comparison-column before">
                    <h3>‚ùå Without Repository</h3>
                    <div class="code-block small">
                        <code>
<span class="comment">// Business logic file</span>
<span class="keyword">async function</span> <span class="function">createUser</span>(email) {
    <span class="comment">// SQL mixed with logic</span>
    <span class="keyword">const</span> exists = <span class="keyword">await</span> db.query(
        <span class="string">'SELECT * FROM users WHERE email = ?'</span>, 
        [email]
    );
    <span class="keyword">if</span> (exists) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">Error</span>(<span class="string">'Exists'</span>);
    
    <span class="keyword">await</span> db.query(
        <span class="string">'INSERT INTO users ...'</span>, 
        [...]
    );
}
<span class="comment">// Want to switch databases?</span>
<span class="comment">// Good luck fixing 50+ files!</span>
                        </code>
                    </div>
                </div>
                <div class="comparison-column after">
                    <h3>‚úÖ With Repository</h3>
                    <div class="code-block small">
                        <code>
<span class="comment">// Business logic file</span>
<span class="keyword">async function</span> <span class="function">createUser</span>(userRepo) {
    <span class="keyword">const</span> exists = <span class="keyword">await</span> userRepo.<span class="function">findByEmail</span>(email);
    <span class="keyword">if</span> (exists) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">Error</span>(<span class="string">'Exists'</span>);
    
    <span class="keyword">await</span> userRepo.<span class="function">save</span>(newUser);
}
<span class="comment">// Database agnostic!</span>
<span class="comment">// Easy to test!</span>
                        </code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Real World Example -->
        <section class="card example">
            <h2>
                <span class="icon">üåç</span>
                Real-World Example
            </h2>
            
            <div class="example-scenario">
                <p><strong>Scenario:</strong> An e-commerce application with users, products, and orders</p>
                
                <div class="diagram-container">
                    <svg class="architecture-diagram" viewBox="0 0 400 200">
                        <!-- Controllers -->
                        <rect x="10" y="40" width="80" height="50" rx="5" fill="#1a1a2e" stroke="#00ff88" stroke-width="2"/>
                        <text x="50" y="70" text-anchor="middle" fill="#00ff88" font-size="10">Controllers</text>
                        
                        <!-- Arrow -->
                        <path d="M95 65 L125 65" stroke="#00ff88" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- Services -->
                        <rect x="130" y="40" width="80" height="50" rx="5" fill="#1a1a2e" stroke="#ff6b6b" stroke-width="2"/>
                        <text x="170" y="70" text-anchor="middle" fill="#ff6b6b" font-size="10">Services</text>
                        
                        <!-- Arrow -->
                        <path d="M215 65 L245 65" stroke="#ff6b6b" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- Repository Layer -->
                        <rect x="250" y="40" width="80" height="50" rx="5" fill="#1a1a2e" stroke="#4ecdc4" stroke-width="2"/>
                        <text x="290" y="70" text-anchor="middle" fill="#4ecdc4" font-size="10">Repositories</text>
                        
                        <!-- Arrow down -->
                        <path d="M290 95 L290 130" stroke="#4ecdc4" stroke-width="2" marker-end="url(#arrowhead)"/>
                        
                        <!-- Database -->
                        <ellipse cx="290" cy="165" rx="60" ry="25" fill="#1a1a2e" stroke="#ffd93d" stroke-width="2"/>
                        <text x="290" y="170" text-anchor="middle" fill="#ffd93d" font-size="10">Database</text>
                        
                        <!-- Legend -->
                        <text x="50" y="190" fill="#666" font-size="9">HTTP ‚Üí Logic ‚Üí Data Access ‚Üí Storage</text>
                        
                        <!-- Arrow marker -->
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="currentColor"/>
                            </marker>
                        </defs>
                    </svg>
                </div>
                
                <p>Each <strong>Service</strong> talks only to <strong>Repositories</strong>. The OrderService doesn't know if orders are stored in PostgreSQL, MongoDB, or a REST API. It just calls <code>orderRepo.findById()</code> and gets an Order.</p>
            </div>
        </section>

        <!-- Key Takeaways -->
        <section class="card takeaways">
            <h2>
                <span class="icon">üéØ</span>
                Key Takeaways
            </h2>
            
            <ul class="takeaway-list">
                <li>
                    <span class="check">‚úì</span>
                    <span><strong>Repository = Abstraction</strong> ‚Äî Hides database complexity behind a clean interface</span>
                </li>
                <li>
                    <span class="check">‚úì</span>
                    <span><strong>Single Responsibility</strong> ‚Äî Each repository handles one entity type</span>
                </li>
                <li>
                    <span class="check">‚úì</span>
                    <span><strong>Testability</strong> ‚Äî Mock the repository, test your logic without DB</span>
                </li>
                <li>
                    <span class="check">‚úì</span>
                    <span><strong>Flexibility</strong> ‚Äî Change databases without rewriting your app</span>
                </li>
            </ul>
        </section>

        <!-- Navigation Footer -->
        <div class="page-nav">
            <a href="../" class="nav-button secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                All Patterns
            </a>
            <a href="#top" class="nav-button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
                </svg>
                Back to Top
            </a>
        </div>
    </main>

    <script>
        // Progress bar on scroll
        window.addEventListener('scroll', () => {
            const scrollTop = document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
            const progress = (scrollTop / scrollHeight) * 100;
            document.querySelector('.progress-fill').style.width = progress + '%';
        });

        // Animate elements on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.card').forEach(card => {
            observer.observe(card);
        });
    </script>
</body>
</html>
