<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repository Pattern ‚Äî Learning Corner</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="progress-bar">
        <div class="progress-fill"></div>
    </div>

    <nav class="top-nav">
        <div class="nav-left">
            <a href="../../" class="back-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                Learning Corner
            </a>
        </div>
        <span class="breadcrumb">Design Patterns / <span>Repository Pattern</span></span>
    </nav>

    <main>
        <!-- Hero -->
        <section class="hero reveal">
            <div class="hero-icon">
                <svg viewBox="0 0 100 100">
                    <!-- Database cylinders -->
                    <ellipse cx="50" cy="25" rx="35" ry="12" fill="none" stroke="white" stroke-width="3"/>
                    <path d="M15 25 Q15 55, 50 55 Q85 55, 85 25" fill="none" stroke="white" stroke-width="3"/>
                    <ellipse cx="50" cy="25" rx="35" ry="12" fill="rgba(255,255,255,0.1)"/>
                    <!-- Connection dots -->
                    <circle cx="15" cy="25" r="5" fill="#F97316"/>
                    <circle cx="85" cy="25" r="5" fill="#F97316"/>
                    <!-- Connector lines -->
                    <line x1="20" y1="25" x2="35" y2="18" stroke="#F97316" stroke-width="2"/>
                    <line x1="80" y1="25" x2="65" y2="18" stroke="#F97316" stroke-width="2"/>
                </svg>
            </div>
            <h1>The Repository Pattern</h1>
            <p class="tagline">Understanding how to talk to databases the clean way</p>
        </section>

        <!-- Summary -->
        <section class="card summary-card reveal">
            <h2>üìã Quick Summary</h2>
            <p>The Repository Pattern is like having a <strong>librarian</strong> between you and the library's books. Instead of running around the stacks yourself, you tell the librarian what you want, and they find it for you. This keeps your code organized and easy to change.</p>
        </section>

        <!-- WHAT -->
        <section class="card reveal" id="what">
            <h2>‚ùì What is it?</h2>
            
            <!-- Visual Analogy -->
            <div class="analogy-box reveal">
                <h3>The Library Analogy</h3>
                <div class="analogy-visual">
                    <div class="analogy-item">
                        <div class="analogy-icon">
                            <svg viewBox="0 0 60 60">
                                <rect x="12" y="8" width="36" height="44" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
                                <line x1="18" y1="18" x2="42" y2="18" stroke="currentColor" stroke-width="2"/>
                                <line x1="18" y1="26" x2="42" y2="26" stroke="currentColor" stroke-width="2"/>
                                <line x1="18" y1="34" x2="35" y2="34" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <span>Database</span>
                        <small>The Library</small>
                    </div>
                    
                    <div class="analogy-arrow">‚Üí</div>
                    
                    <div class="analogy-item highlight">
                        <div class="analogy-icon">
                            <svg viewBox="0 0 60 60">
                                <circle cx="30" cy="22" r="12" fill="none" stroke="currentColor" stroke-width="2"/>
                                <circle cx="30" cy="48" r="14" fill="none" stroke="currentColor" stroke-width="2"/>
                                <circle cx="30" cy="22" r="7" fill="var(--primary)"/>
                            </svg>
                        </div>
                        <span>Repository</span>
                        <small>The Librarian</small>
                    </div>
                    
                    <div class="analogy-arrow">‚Üí</div>
                    
                    <div class="analogy-item">
                        <div class="analogy-icon">
                            <svg viewBox="0 0 60 60">
                                <rect x="15" y="12" width="30" height="38" rx="3" fill="none" stroke="currentColor" stroke-width="2"/>
                                <circle cx="30" cy="31" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <span>Your Code</span>
                        <small>You</small>
                    </div>
                </div>
                <p class="analogy-text">The <strong>librarian (Repository)</strong> knows exactly where every book is. You just say "I want all books by this author" and they bring them to you.</p>
            </div>

            <div class="definition-box reveal">
                <h3>Technical Definition</h3>
                <p>A <strong>Repository</strong> is a layer that mediates between your domain logic and the data access layer. It abstracts the database operations behind a collection-like interface, making your code independent of specific database technologies.</p>
            </div>
        </section>

        <!-- WHY -->
        <section class="card reveal" id="why">
            <h2>üí° Why use it?</h2>
            
            <div class="benefits-grid">
                <div class="benefit reveal">
                    <div class="benefit-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                        </svg>
                    </div>
                    <h4>Single Source of Truth</h4>
                    <p>All data access logic lives in one place. Change how you query? Update one file, not fifty.</p>
                </div>
                
                <div class="benefit reveal">
                    <div class="benefit-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                    </div>
                    <h4>Easier Testing</h4>
                    <p>Swap the real database for fake data in tests. Your tests run fast and don't break.</p>
                </div>
                
                <div class="benefit reveal">
                    <div class="benefit-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"/>
                        </svg>
                    </div>
                    <h4>Database Independence</h4>
                    <p>Switch from PostgreSQL to MongoDB without rewriting your business logic.</p>
                </div>
                
                <div class="benefit reveal">
                    <div class="benefit-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                    </div>
                    <h4>Cleaner Code</h4>
                    <p>Your business logic stays focused on business. No SQL mixed with your app code.</p>
                </div>
            </div>
        </section>

        <!-- WHEN -->
        <section class="card reveal" id="when">
            <h2>‚è∞ When should you use it?</h2>
            
            <div class="timeline reveal">
                <div class="timeline-item yes">
                    <h4>‚úÖ Use Repository Pattern when:</h4>
                    <ul>
                        <li>Your app has multiple data sources (database, API, cache)</li>
                        <li>You need to unit test without touching a database</li>
                        <li>Your data access logic is getting complex and repetitive</li>
                        <li>You want to keep your code framework-agnostic</li>
                        <li>Team members need to work separately on data access and logic</li>
                    </ul>
                </div>
                
                <div class="timeline-item no">
                    <h4>‚è≥ Consider skipping if:</h4>
                    <ul>
                        <li>Your app is very simple (CRUD on a single table)</li>
                        <li>You're using an ORM that already provides good abstraction</li>
                        <li>Rapid prototyping where abstraction adds overhead</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- HOW -->
        <section class="card reveal" id="how">
            <h2>üîß How does it work?</h2>
            
            <!-- Step 1 -->
            <div class="step-section reveal">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Define the Interface</h4>
                    <p>Tell the world what operations you support</p>
                    <div class="code-block">
<code><span class="keyword">interface</span> <span class="type">UserRepository</span> {
    <span class="function">findById</span>(id: <span class="type">string</span>): <span class="type">Promise</span>&lt;<span class="type">User</span>&gt;;
    <span class="function">findByEmail</span>(email: <span class="type">string</span>): <span class="type">Promise</span>&lt;<span class="type">User</span> | <span class="keyword">null</span>&gt;;
    <span class="function">save</span>(user: <span class="type">User</span>): <span class="type">Promise</span>&lt;<span class="type">void</span>&gt;;
    <span class="function">delete</span>(id: <span class="type">string</span>): <span class="type">Promise</span>&lt;<span class="type">void</span>&gt;;
}</code>
                    </div>
                </div>
            </div>
            
            <!-- Step 2 -->
            <div class="step-section reveal">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Implement the Interface</h4>
                    <p>Actually talk to the database</p>
                    <div class="code-block">
<code><span class="keyword">class</span> <span class="type">PostgresUserRepository</span> <span class="keyword">implements</span> <span class="type">UserRepository</span> {
    <span class="keyword">constructor</span>(<span class="variable">private</span> db: <span class="type">Database</span>) {}
    
    <span class="async">async</span> <span class="function">findById</span>(id: <span class="type">string</span>) {
        <span class="keyword">const</span> row = <span class="keyword">await</span> <span class="variable">this</span>.db.query(
            <span class="string">'SELECT * FROM users WHERE id = $1'</span>, [id]
        );
        <span class="keyword">return</span> row ? <span class="function">mapToUser</span>(row) : <span class="keyword">null</span>;
    }
}</code>
                    </div>
                </div>
            </div>
            
            <!-- Step 3 -->
            <div class="step-section reveal">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>Use in Your Code</h4>
                    <p>Clean, testable business logic</p>
                    <div class="code-block">
<code><span class="keyword">class</span> <span class="type">UserService</span> {
    <span class="keyword">constructor</span>(<span class="variable">private</span> userRepo: <span class="type">UserRepository</span>) {}
    
    <span class="async">async</span> <span class="function">registerUser</span>(email: <span class="type">string</span>) {
        <span class="comment">// No SQL here! Just business logic</span>
        <span class="keyword">const</span> exists = <span class="keyword">await</span> <span class="variable">this</span>.userRepo.<span class="function">findByEmail</span>(email);
        <span class="keyword">if</span> (exists) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">Error</span>(<span class="string">'Already exists'</span>);
        
        <span class="comment">// ... create user ...</span>
    }
}</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Before/After -->
        <section class="card reveal" id="comparison">
            <h2>üîÑ Before vs After</h2>
            
            <div class="comparison-grid">
                <div class="comparison-col before">
                    <h3>‚ùå Without Repository</h3>
                    <div class="code-block small">
<code><span class="comment">// Business logic file</span>
<span class="keyword">async function</span> <span class="function">createUser</span>(email) {
    <span class="comment">// SQL mixed with logic</span>
    <span class="keyword">const</span> exists = <span class="keyword">await</span> db.query(
        <span class="string">'SELECT * FROM users WHERE email = ?'</span>, 
        [email]
    );
    <span class="keyword">if</span> (exists) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">Error</span>(<span class="string">'Exists'</span>);
    
    <span class="keyword">await</span> db.query(<span class="string">'INSERT INTO users ...'</span>, [...]);
}
<span class="comment">// Want to switch databases?</span>
<span class="comment">// Good luck fixing 50+ files!</span></code>
                    </div>
                </div>
                
                <div class="comparison-col after">
                    <h3>‚úÖ With Repository</h3>
                    <div class="code-block small">
<code><span class="comment">// Business logic file</span>
<span class="keyword">async function</span> <span class="function">createUser</span>(userRepo) {
    <span class="keyword">const</span> exists = <span class="keyword">await</span> userRepo.<span class="function">findByEmail</span>(email);
    <span class="keyword">if</span> (exists) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">Error</span>(<span class="string">'Exists'</span>);
    
    <span class="keyword">await</span> userRepo.<span class="function">save</span>(newUser);
}
<span class="comment">// Database agnostic!</span>
<span class="comment">// Easy to test!</span></code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Real World Example -->
        <section class="card reveal">
            <h2>üåç Real-World Example</h2>
            <p><strong>Scenario:</strong> An e-commerce application with users, products, and orders</p>
            
            <div class="architecture-diagram reveal">
                <svg viewBox="0 0 500 200" class="diagram-svg">
                    <!-- Controllers -->
                    <rect x="20" y="60" width="80" height="50" rx="8" fill="#4F46E5"/>
                    <text x="60" y="90" text-anchor="middle" fill="white" font-size="11" font-weight="500">Controllers</text>
                    
                    <!-- Arrow 1 -->
                    <path d="M105 85 L135 85" stroke="#4F46E5" stroke-width="2" marker-end="url(#arrow)"/>
                    
                    <!-- Services -->
                    <rect x="140" y="60" width="80" height="50" rx="8" fill="#F97316"/>
                    <text x="180" y="90" text-anchor="middle" fill="white" font-size="11" font-weight="500">Services</text>
                    
                    <!-- Arrow 2 -->
                    <path d="M225 85 L255 85" stroke="#F97316" stroke-width="2" marker-end="url(#arrow)"/>
                    
                    <!-- Repositories -->
                    <rect x="260" y="60" width="100" height="50" rx="8" fill="#10B981"/>
                    <text x="310" y="90" text-anchor="middle" fill="white" font-size="11" font-weight="500">Repositories</text>
                    
                    <!-- Arrow down -->
                    <path d="M310 115 L310 145" stroke="#10B981" stroke-width="2" marker-end="url(#arrow)"/>
                    
                    <!-- Database -->
                    <ellipse cx="310" cy="170" rx="70" ry="25" fill="#1E1B4B"/>
                    <text x="310" y="175" text-anchor="middle" fill="white" font-size="12" font-weight="500">Database</text>
                    
                    <!-- Labels -->
                    <text x="60" y="180" fill="#6B7280" font-size="10" text-anchor="middle">HTTP Requests</text>
                    <text x="310" y="195" fill="#6B7280" font-size="10" text-anchor="middle">Data Storage</text>
                    
                    <!-- Arrow marker -->
                    <defs>
                        <marker id="arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                            <polygon points="0 0, 8 4, 0 8" fill="currentColor"/>
                        </marker>
                    </defs>
                </svg>
            </div>
            
            <p class="diagram-caption">Each <strong>Service</strong> talks only to <strong>Repositories</strong>. The OrderService doesn't know if orders are stored in PostgreSQL, MongoDB, or a REST API.</p>
        </section>

        <!-- Key Takeaways -->
        <section class="card reveal">
            <h2>üéØ Key Takeaways</h2>
            
            <ul class="takeaway-list">
                <li>
                    <span class="check">‚úì</span>
                    <span><strong>Repository = Abstraction</strong> ‚Äî Hides database complexity behind a clean interface</span>
                </li>
                <li>
                    <span class="check">‚úì</span>
                    <span><strong>Single Responsibility</strong> ‚Äî Each repository handles one entity type</span>
                </li>
                <li>
                    <span class="check">‚úì</span>
                    <span><strong>Testability</strong> ‚Äî Mock the repository, test your logic without DB</span>
                </li>
                <li>
                    <span class="check">‚úì</span>
                    <span><strong>Flexibility</strong> ‚Äî Change databases without rewriting your app</span>
                </li>
            </ul>
        </section>

        <!-- Navigation -->
        <div class="page-nav reveal">
            <a href="../../" class="nav-button secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                All Categories
            </a>
            <a href="#" class="nav-button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
                </svg>
                Back to Top
            </a>
        </div>
    </main>

    <script>
        // Progress bar on scroll
        window.addEventListener('scroll', () => {
            const scrollTop = document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
            const progress = (scrollTop / scrollHeight) * 100;
            document.querySelector('.progress-fill').style.width = progress + '%';
        });

        // Scroll reveal animation
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    </script>
</body>
</html>
